<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Bubblegum : java micro web framework" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Bubblegum</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/janickr/bubblegum">View on GitHub</a>

          <h1 id="project_title">Bubblegum</h1>
          <h2 id="project_tagline">java micro web framework</h2>

            <section id="downloads">
                <a href="binaries/bubblegum-0.9.4-sources.zip">sources</a> <a href="binaries/bubblegum-0.9.4.jar">jar</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="bubblegum---a-micro-web-framework-for-java" class="anchor" href="#bubblegum---a-micro-web-framework-for-java"><span class="octicon octicon-link"></span></a>Bubblegum - a micro web framework for java</h1>

<p>Less than 50KB and does not depend on jars other than the servlet api.
It's only purpose is to match routes to handlers.</p>

<p>Bubblegum is inspired by <a href="https://github.com/perwendel/spark">Spark</a>, but there are important differences. In Bubblegum:</p>

<ul>
<li>Paths are matched case-sensitive, path parameters extracted without changing case</li>
<li>Requests can be matched on any of its properties for example on the Accept or Content-type headers</li>
<li>Handlers can throw exceptions</li>
<li>Filters are more servlet Filter-like (but with more expressive filter mapping)</li>
<li>JdbcHelper makes queries easy, ConnectionProvider provides request-scoped jdbc transactions (Optional - it's a bubblegum Filter)</li>
</ul><p>Get the jar at <a href="http://janickreynders.be/bubblegum">http://janickreynders.be/bubblegum</a></p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>1) Implement the App interface</p>

<div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">yourpackage</span><span class="o">.</span><span class="na">test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">be.janickreynders.bubblegum.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestApp</span> <span class="kd">implements</span> <span class="n">App</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Config</span> <span class="nf">createConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Config</span> <span class="n">on</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Config</span><span class="o">();</span>

        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/hello/:name"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">resp</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"Hello "</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="o">+</span> <span class="s">"!"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="k">return</span> <span class="n">on</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>2) Add Bubblegum to your web.xml</p>

<div class="highlight"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
           <span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span>
           <span class="na">version=</span><span class="s">"2.5"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;filter&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>Bubblegum<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;filter-class&gt;</span>be.janickreynders.bubblegum.Bubblegum<span class="nt">&lt;/filter-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>app<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>com.yourpackage.test.TestApp<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>

    <span class="nt">&lt;filter-mapping&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>Bubblegum<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
        <span class="nt">&lt;dispatcher&gt;</span>REQUEST<span class="nt">&lt;/dispatcher&gt;</span>
        <span class="nt">&lt;dispatcher&gt;</span>FORWARD<span class="nt">&lt;/dispatcher&gt;</span>
        <span class="nt">&lt;dispatcher&gt;</span>INCLUDE<span class="nt">&lt;/dispatcher&gt;</span>
        <span class="nt">&lt;dispatcher&gt;</span>ERROR<span class="nt">&lt;/dispatcher&gt;</span>
    <span class="nt">&lt;/filter-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</pre></div>

<p>3) That's it! Deploy and point your browser to http://localhost/hello/chuck</p>

<h2>
<a name="copyright-and-license" class="anchor" href="#copyright-and-license"><span class="octicon octicon-link"></span></a>Copyright and License</h2>

<p>Copyright Â© 2012-, Janick Reynders. Licensed under <a href="https://github.com/janickr/bubblegum/raw/master/LICENSE.txt">MIT License</a>.</p>

<h2>
<a name="more-examples" class="anchor" href="#more-examples"><span class="octicon octicon-link"></span></a>More Examples</h2>

<div class="highlight"><pre><span class="kn">import</span> <span class="nn">be.janickreynders.bubblegum.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">be</span><span class="o">.</span><span class="na">janickreynders</span><span class="o">.</span><span class="na">bubblegum</span><span class="o">.</span><span class="na">Filters</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">be</span><span class="o">.</span><span class="na">janickreynders</span><span class="o">.</span><span class="na">bubblegum</span><span class="o">.</span><span class="na">Handlers</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">be</span><span class="o">.</span><span class="na">janickreynders</span><span class="o">.</span><span class="na">bubblegum</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Examples</span> <span class="kd">implements</span> <span class="n">App</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Config</span> <span class="nf">createConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Config</span> <span class="n">on</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Config</span><span class="o">();</span>

        <span class="c1">// forward a request to a jsp</span>
        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/forward/me"</span><span class="o">,</span> <span class="n">forward</span><span class="o">(</span><span class="s">"/forwarded.jsp"</span><span class="o">));</span>

        <span class="c1">// forward a request to a jsp in WEB-INF/jsp</span>
        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/forward/me2"</span><span class="o">,</span> <span class="n">forward</span><span class="o">(</span><span class="s">"/WEB-INF/jsp/forwarded.jsp"</span><span class="o">));</span>

        <span class="c1">// forward a request to another handler</span>
        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/forward/again"</span><span class="o">,</span> <span class="n">forward</span><span class="o">(</span><span class="s">"/textcontent"</span><span class="o">));</span>

        <span class="c1">// match the paths '/different/this' and '/different/some-other-thing'</span>
        <span class="c1">//   but not '/different/that/or/this'</span>
        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/different/*"</span><span class="o">,</span> <span class="n">forward</span><span class="o">(</span><span class="s">"/forwarded.html"</span><span class="o">));</span>

        <span class="c1">// match any of '/multiple/this/levels', '/multiple/this/or/that/levels' ,...</span>
        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/multiple/**/levels"</span><span class="o">,</span> <span class="n">forward</span><span class="o">(</span><span class="s">"/forwarded.txt"</span><span class="o">));</span>

        <span class="c1">// redirect to a different url</span>
        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/redirect/me"</span><span class="o">,</span> <span class="n">redirect</span><span class="o">(</span><span class="s">"/redirected"</span><span class="o">));</span>

        <span class="c1">// using a path variable</span>
        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/collection/:id"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">resp</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"you requested: "</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="c1">// set the content type of the response</span>
        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/textcontent"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">resp</span><span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"text/plain"</span><span class="o">);</span>
                <span class="n">resp</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"You are getting a text response"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="c1">// post to a url</span>
        <span class="n">on</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/collection"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"inputFieldName"</span><span class="o">);</span>

                <span class="n">resp</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"you posted: "</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="c1">// another http method</span>
        <span class="n">on</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="s">"/collection/:id"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">resp</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"you deleted: "</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"id"</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">});</span>


        <span class="c1">// different response for different request Accept headers</span>
        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/variant"</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="s">"text/html"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">resp</span><span class="o">.</span><span class="na">vary</span><span class="o">(</span><span class="s">"Accept"</span><span class="o">);</span>
                <span class="n">resp</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"&lt;html&gt;&lt;body&gt; This is the html variant &lt;/body&gt;&lt;/html&gt;"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/variant"</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">resp</span><span class="o">.</span><span class="na">vary</span><span class="o">(</span><span class="s">"Accept"</span><span class="o">);</span>
                <span class="n">resp</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"{ \"message\": \"This is the json variant\" }"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="c1">// interpreting different request body content types</span>
        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/requestbody"</span><span class="o">,</span> <span class="n">contentType</span><span class="o">(</span><span class="s">"application/x-www-form-urlencoded"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="c1">// get params with req.param();</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/requestbody"</span><span class="o">,</span> <span class="n">contentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="c1">// parse the json in req.body()</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="c1">// match multiple http methods, and return a status code</span>
        <span class="n">on</span><span class="o">.</span><span class="na">route</span><span class="o">(</span><span class="s">"/multiple-methods"</span><span class="o">,</span> <span class="n">any</span><span class="o">(</span><span class="n">method</span><span class="o">(</span><span class="s">"post"</span><span class="o">),</span> <span class="n">method</span><span class="o">(</span><span class="s">"put"</span><span class="o">),</span> <span class="n">method</span><span class="o">(</span><span class="s">"delete"</span><span class="o">)),</span>
            <span class="n">status</span><span class="o">(</span><span class="n">HttpServletResponse</span><span class="o">.</span><span class="na">SC_FORBIDDEN</span><span class="o">));</span>


        <span class="cm">/********************** filter examples **********************/</span>

        <span class="c1">// cache /js/thirdparty/** forever</span>
        <span class="n">on</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="s">"/js/thirdparty/**"</span><span class="o">,</span> <span class="n">cacheNeverExpires</span><span class="o">());</span>

        <span class="c1">// forward to an error jsp on a certain exception</span>
        <span class="n">on</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">catchAndHandle</span><span class="o">(</span><span class="n">IllegalStateException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">forward</span><span class="o">(</span><span class="s">"/oops.jsp"</span><span class="o">)));</span>

        <span class="k">return</span> <span class="n">on</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<h2>
<a name="jdbc-helper" class="anchor" href="#jdbc-helper"><span class="octicon octicon-link"></span></a>Jdbc helper</h2>

<p>JdbcHelper contains some convenience methods for querying a rdbms. If you configure ConnectionProvider as a bubblegum filter
it will always return the same connection during a request (the connection is bound to the thread).
After the request the transaction is committed (or rolled back in case the handler threw an exception)
and the connection will be closed.</p>

<div class="highlight"><pre><span class="kn">import</span> <span class="nn">be.janickreynders.bubblegum.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">be.janickreynders.bubblegum.jdbc.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.naming.InitialContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.naming.NamingException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutorService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">be</span><span class="o">.</span><span class="na">janickreynders</span><span class="o">.</span><span class="na">bubblegum</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">accept</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">be</span><span class="o">.</span><span class="na">janickreynders</span><span class="o">.</span><span class="na">bubblegum</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">ConnectionProvider</span><span class="o">.</span><span class="na">withDbConnection</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcExample</span> <span class="kd">implements</span> <span class="n">App</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Config</span> <span class="nf">createConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">JdbcHelper</span> <span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdbcHelper</span><span class="o">(</span><span class="n">getDataSource</span><span class="o">());</span>

        <span class="n">Config</span> <span class="n">on</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Config</span><span class="o">();</span>

        <span class="n">on</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">new ConnectionProvider()</span><span class="o">);</span> <span class="c1">// ConnectionProvider is a filter that returns the same open connection during your request</span>
                      <span class="c1">// It will commit your transaction after the request and closes the connection</span>

        <span class="n">on</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/insertSomething"</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="s">"text/html"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">value1</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"inputFieldName1"</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">value2</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"inputFieldName2"</span><span class="o">);</span>
                <span class="n">db</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"insert into my_table (value1, value2) values (?, ?)"</span><span class="o">,</span> <span class="n">value1</span><span class="o">,</span> <span class="n">value2</span><span class="o">);</span>

                <span class="n">resp</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"you inserted: "</span> <span class="o">+</span> <span class="n">value1</span> <span class="o">+</span> <span class="s">" and "</span> <span class="o">+</span> <span class="n">value2</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">on</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/queryValue2/:value1"</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="s">"text/html"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">value1</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"value1"</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">value2</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"select value2 from my_table where value1 = ?"</span><span class="o">,</span> <span class="n">value1</span><span class="o">);</span>

                <span class="n">resp</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">value2</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">on</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/doSomethingAsynchronousInOneTransaction"</span><span class="o">,</span> <span class="n">accept</span><span class="o">(</span><span class="s">"text/html"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">,</span> <span class="n">Response</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">withDbConnection</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                        <span class="n">db</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"insert into this_table (some_col) values (?)"</span><span class="o">,</span> <span class="s">"one thing"</span><span class="o">);</span>
                        <span class="n">db</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"insert into that_table (some_col) values (?)"</span><span class="o">,</span> <span class="s">"another thing"</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}));</span>

                <span class="n">resp</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"it's running"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="k">return</span> <span class="n">on</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">DataSource</span> <span class="nf">getDataSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">(</span><span class="n">DataSource</span><span class="o">)</span> <span class="k">new</span> <span class="n">InitialContext</span><span class="o">().</span><span class="na">lookup</span><span class="o">(</span><span class="s">"java:/comp/env/jdbc/yourDatasourceNameInJNDI"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NamingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">// you could also just create your datasource here instead of having one configured in JNDI</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">JdbcExample</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ExecutorService</span> <span class="n">executor</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Bubblegum maintained by <a href="https://github.com/janickr">janickr</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-37769242-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
